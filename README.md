RESTful API Server Example
==========================

This project showcases my vision on how the RESTful API server should be
implemented.

The goals that were achived in this example:

* RESTful API server should be self-documented using Swagger specifications,
  so interactive documentation UI is in place;
* Authentication is handled with OAuth2 and using Resource Owner Password
  Credentials Grant (Password Flow) for first-party clients makes it usable
  not only for third-party "external" apps;
* Permissions are handled (and automaticaly documented);
* PATCH method can be handled accordingly to
  [RFC 6902](http://tools.ietf.org/html/rfc6902).

I had to patch Flask-RESTplus (see `flask_restplus_patched` folder), so it can
handle Marshmallow schemas and Webargs arguments.

This is still work-in-progress project, but it already has some value, so I
publish it. Here is how it looks at this point of time:

![Flask RESTplus Example API](https://raw.githubusercontent.com/frol/flask-restplus-server-example/master/docs/static/Flask_RESTplus_Example_API.png)


Dependencies
------------

### Project Dependencies

* flask-restplus (flask, flask-restful)
* sqlalchemy (+ flask-sqlalchemy) - Database ORM.
* sqlalchemy-utils - for nice custom fields (e.g., PasswordField).
* alembic (+ flask-alembic) - for DB migrations.
* marshmallow / webargs / apispec (+ marshmallow-sqlalchemy, flask-marshmallow) - for parameters and definitions.
* oauthlib (+ flask-oauthlib) - for authentication.
* flask-login - for `current_user` integration only.
* bcrypt - for password hashing (used as a backend by sqlalchemy-utils.PasswordField).
* permission - for authorization.
* Swagger-UI - for interactive RESTful API documentation.

### Build Dependencies

I use [`pyinvoke`](http://pyinvoke.org) with custom tasks to maintain easy and
nice command-line interface. Thus, it is required to have `invoke` Python
package installed, and optionally you may want to install `colorlog`, so your
life become colorful.

### Patched Dependencies

* flask-restplus: patched to handle marshmallow schemes and webargs input 
  parameters ([GH #9](https://github.com/noirbizarre/flask-restplus/issues/9)),
  and to handle PATCH method as it is described in
  [RFC 6902](http://tools.ietf.org/html/rfc6902)
  ([GH #11](https://github.com/noirbizarre/flask-restplus/issues/11))
* swagger-ui: applied
  JSON Editor
  ([PR #1589](https://github.com/swagger-api/swagger-ui/pull/1589)),
  and Resource Owner Password Credentials Grant OAuth2 (Password Flow)
  ([PR #1574](https://github.com/swagger-api/swagger-ui/pull/1574))


Installation
------------

### Using Docker

It is very easy to start exploring the example using Docker:

```bash
$ docker run -it --rm --publish 5000:5000 frolvlad/flask-restplus-server-example
```

[![](https://badge.imagelayers.io/frolvlad/flask-restplus-server-example:latest.svg)](https://imagelayers.io/?images=frolvlad/flask-restplus-server-example:latest 'Get your own badge on imagelayers.io')


### From sources

#### Clone the Project

```bash
$ git clone https://github.com/frol/flask-restplus-server-example.git
```

#### Setup Environment

It is recommended to use virtualenv or Anaconda/Miniconda to manage Python
dependencies. Please, learn details yourself.

You will need `invoke` package to work with everything related to this project.

```bash
$ pip install invoke colorlog
```


#### Run Server

NOTE: All dependencies and database migrations will be automatically handled,
so go ahead and turn the server ON! (Read more details on this in Tips section)

```bash
$ invoke app.run
```


Quickstart
----------

Open online interactive API documentation:
[http://127.0.0.1:5000/api/v1/](http://127.0.0.1:5000/api/v1/)

Autogenerated swagger config is always available from
[http://127.0.0.1:5000/api/v1/swagger.json](http://127.0.0.1:5000/api/v1/swagger.json)

`example.db` (SQLite) includes 2 users:

* Admin user `root` with password `q`
* Regular user `user` with password `w`

NOTE: Use On/Off switch in documentation to sign in.


Tips
----

Once you have invoke, you can learn all available commands related to this
project from:

```bash
$ invoke --list
```

Learn more about each command with the following syntax:

```bash
$ invoke --help <task>
```

For example:

```bash
$ invoke --help app.run
Usage: inv[oke] [--core-opts] app.run [--options] [other tasks here ...]

Docstring:
  Run DDOTS RESTful API Server.

Options:
  -d, --[no-]debug
  -h STRING, --host=STRING
  -i, --[no-]install-dependencies
  -p, --port
  -u, --[no-]upgrade-db
```

Use the following command to enter ipython shell (`ipython` must be installed):

```bash
$ invoke app.env.enter
```

`app.run` and `app.env.enter` tasks automatically prepare all dependencies
(using `pip install`) and migrate database schema to the latest version.

Database schema migration is handled via `app.db.*` tasks group. The most
common migration commands are `app.db.upgrade` (it is automatically run on
`app.run`), and `app.db.migrate` (creates a new migration).
